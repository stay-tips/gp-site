{{ define "main" }}
{{ partial "page-title.html" . }}

<section class="section booking-confirmation">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="card border-0 shadow-lg">
          <div class="card-body p-5">
            <h2 class="card-title text-center mb-4">Conferma Prenotazione</h2>

            <div class="booking-details mb-4">
              <h4>Dettagli Prenotazione</h4>
              <div class="row">
                <div class="col-md-6">
                  <p><strong>Appartamento:</strong> <span id="apartment-name"></span></p>
                  <p><strong>Date:</strong> <span id="booking-dates"></span></p>
                </div>
                <div class="col-md-6">
                  <p><strong>Ospiti:</strong> <span id="guest-count"></span></p>
                  <p><strong>Prezzo Totale:</strong> <span id="total-price"></span></p>
                </div>
              </div>
            </div>

            <form id="payment-form" class="payment-form">
              <h4 class="mb-3">Dettagli Pagamento</h4>

              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="card-name">Nome sul Carta</label>
                  <input type="text" class="form-control" id="card-name" required>
                </div>
                <div class="form-group col-md-6">
                  <label for="card-number">Numero Carta</label>
                  <input type="text" class="form-control" id="card-number" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="card-expiry">Scadenza</label>
                  <input type="text" class="form-control" id="card-expiry" placeholder="MM/AA" required>
                </div>
                <div class="form-group col-md-4">
                  <label for="card-cvv">CVV</label>
                  <input type="text" class="form-control" id="card-cvv" required>
                </div>
                <div class="form-group col-md-4">
                  <label for="card-type">Tipo Carta</label>
                  <select class="form-control" id="card-type" required>
                    <option value="">Seleziona</option>
                    <option value="visa">Visa</option>
                    <option value="mastercard">Mastercard</option>
                    <option value="amex">American Express</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="terms-agree" required>
                  <label class="custom-control-label" for="terms-agree">
                    Dichiaro di aver letto e accettato i <a href="/terms">termini e condizioni</a>
                  </label>
                </div>
              </div>

              <button type="submit" class="btn btn-primary btn-block">
                Conferma Pagamento
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Recupera i dettagli della prenotazione dal localStorage
    const bookingDetails = JSON.parse(localStorage.getItem('bookingDetails') || '{}');

    // Popola i campi con i dettagli della prenotazione
    document.getElementById('apartment-name').textContent = bookingDetails.apartmentName || 'Non specificato';
    document.getElementById('booking-dates').textContent =
      `${bookingDetails.checkIn || 'Data non specificata'} - ${bookingDetails.checkOut || ''}`;
    document.getElementById('guest-count').textContent =
      `${bookingDetails.adults || 0} adulti, ${bookingDetails.children || 0} bambini`;
    document.getElementById('total-price').textContent =
      `â‚¬${bookingDetails.totalPrice || '0.00'}`;

    // Gestione del form di pagamento
    const paymentForm = document.getElementById('payment-form');
    paymentForm.addEventListener('submit', function (e) {
      e.preventDefault();

      // Validazione di base
      const cardName = document.getElementById('card-name').value;
      const cardNumber = document.getElementById('card-number').value;
      const cardExpiry = document.getElementById('card-expiry').value;
      const cardCVV = document.getElementById('card-cvv').value;
      const cardType = document.getElementById('card-type').value;

      // Qui dovresti implementare una vera validazione
      // e chiamata al servizio di pagamento
      if (cardName && cardNumber && cardExpiry && cardCVV && cardType) {
        // Simula elaborazione pagamento
        alert('Pagamento in elaborazione...');

        // Invia dettagli prenotazione al backend (da implementare)
        // fetch('/api/bookings', {
        //   method: 'POST',
        //   body: JSON.stringify(bookingDetails)
        // })

        // Reindirizza alla pagina di conferma
        window.location.href = '/booking/success';
      } else {
        alert('Per favore compila tutti i campi');
      }
    });
  });
</script>
{{ end }}